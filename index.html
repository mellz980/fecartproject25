<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<title>Reconhecimento IA - Profissional</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #1f3c88;
  --secondary: #2ad1a2;
  --accent: #ff6f3c;
  --accent-hover: #ffd93b;
  --bg: #f0f8ff;
  --text: #333;
  --card-bg: #fff;
  --label: #2ad1a2;
}

* { box-sizing: border-box; margin:0; padding:0; font-family: 'Fredoka', sans-serif; }
body { background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 20px; min-height:100vh; }

header {
  width: 100%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  padding: 25px 0;
  text-align: center;
  font-size: 2.2em;
  font-weight: 700;
  color: #fff;
  border-radius: 0 0 30px 30px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
}

/* Hero */
.hero-section { display: flex; flex-wrap: wrap; justify-content:center; align-items:center; max-width:950px; width:100%; margin-top:30px; background: var(--card-bg); padding:40px; border-radius:30px; box-shadow:0 15px 35px rgba(31,60,136,0.15);}
.hero-text { flex:1; min-width:280px; }
.hero-text h2 { font-size:3em; color: var(--primary); margin-bottom:15px; }
.hero-text h2 span { color: var(--accent); animation: colorpulse 3s infinite alternate; }
@keyframes colorpulse {0%{color:#ff6f3c;}50%{color:#ffd93b;}100%{color:#2ad1a2;}}
.hero-text p { font-size:1.3em; margin-bottom:30px; line-height:1.6; }
#username { font-size:1.4em; padding:12px; border-radius:10px; border:1px solid #ccc; margin-bottom:12px; width:80%; }
.hero-main-image { max-width:400px; width:100%; height:280px; object-fit:cover; border-radius:25px; box-shadow:0 15px 30px rgba(31,60,136,0.2); transition: transform 0.5s; }
.hero-main-image:hover { transform: scale(1.05) rotate(-1deg); }
.start-btn { background: var(--accent); color:#fff; font-size:1.3em; font-weight:700; padding:18px 50px; border-radius:35px; border:none; cursor:pointer; box-shadow:0 10px 20px rgba(255,111,60,0.5); transition: all 0.3s; }
.start-btn:hover { background: var(--accent-hover); color: var(--primary); transform: scale(1.1); box-shadow:0 12px 25px rgba(255,217,59,0.5); }

/* Ranking */
#ranking { margin-top:25px; width:100%; max-width:950px; background: var(--card-bg); padding:20px; border-radius:25px; box-shadow:0 15px 35px rgba(31,60,136,0.1); }
#ranking h3 { text-align:center; margin-bottom:12px; font-size:1.8em; }
#ranking ol { padding-left:20px; font-size:1.4em; }
#ranking li { margin-bottom:10px; cursor: pointer; display:flex; justify-content:space-between; align-items:center; }
#ranking li span { color:red; font-size:0.9em; margin-left:10px; cursor:pointer; }

/* Carrossel */
.image-carousel { width:100%; max-width:950px; margin:26px auto 0; background:var(--card-bg); border-radius:25px; box-shadow:0 10px 25px rgba(31,60,136,0.1); overflow:hidden; position:relative; }
.image-carousel-track { display:flex; transition: transform 0.8s ease; }
.image-carousel img { width:220px; height:140px; object-fit:cover; margin:5px; border-radius:14px; box-shadow:0 6px 18px rgba(13,31,64,.1); transition: all 0.3s; filter: blur(2px); opacity:0.7; }
.image-carousel img.active { filter: blur(0); opacity:1; transform: scale(1.05); }
.carousel-btn { position:absolute; top:50%; transform:translateY(-50%); background:rgba(31,60,136,.2); border:none; padding:10px; cursor:pointer; border-radius:50%; font-size:1.5rem; color:#fff; transition:0.2s; }
.carousel-btn:hover { background: rgba(31,60,136,.4); }
.carousel-prev { left:10px; }
.carousel-next { right:10px; }

/* Webcam e painel */
#modelo { display:none; margin-top:50px; max-width:950px; width:100%; background:var(--card-bg); padding:40px; border-radius:25px; box-shadow:0 15px 35px rgba(31,60,136,0.1); position:relative; }
#modelo.active { display:flex; flex-direction:column; align-items:center; gap:30px; }
.webcam-section { display:flex; flex-wrap:wrap; justify-content:center; align-items:flex-start; gap:30px; width:100%; position:relative; }
#webcam-container { border:4px dashed var(--label); padding:10px; border-radius:25px; background:#e6f9f6; box-shadow:0 10px 25px rgba(42,209,162,0.3); transition: all 0.5s ease; display:flex; justify-content:center; align-items:center;}
#webcam-container.correct { border-color:#2ad13f; box-shadow:0 12px 30px rgba(42,209,63,0.5);}
#webcam-container.wrong { border-color:#ff3c3c; box-shadow:0 12px 30px rgba(255,60,60,0.5);}
#webcam-container.capturing { border-color:#ffd93b; box-shadow:0 12px 30px rgba(255,217,59,0.5);}
canvas { border-radius:20px; width:560px !important; height:360px !important; }
.emotion-panel { display:flex; flex-direction:column; justify-content:center; align-items:center; gap:20px; min-width:220px; position:relative; }
#current-emotion { font-size:3em; font-weight:700; color:var(--accent); text-align:center; }
#score-display { font-size:1.5em; font-weight:600; color:var(--primary); }

/* Feedback grande */
#feedback { font-size:2em; font-weight:700; transition: all 0.5s; text-align:center; height:60px; }
#feedback.correct { color:#2ad13f; animation: pop 0.6s; }
#feedback.wrong { color:#ff3c3c; animation: pop 0.6s; }
@keyframes pop { 0%{transform:scale(1);}50%{transform:scale(1.3);}100%{transform:scale(1);} }

/* Barra de progresso */
#progress-container { width:100%; max-width:950px; background:#ddd; border-radius:20px; overflow:hidden; margin-top:15px; }
#progress-bar { width:0%; height:18px; background:var(--accent); transition: width 0.5s ease; border-radius:20px; }

/* Resultado final */
#final-screen { display:none; flex-direction:column; align-items:center; justify-content:center; gap:25px; text-align:center; padding:50px; }
#final-screen.active { display:flex; animation:fadeIn 1s ease forwards; }
#final-screen h2 { font-size:3em; color:var(--primary); }
#final-screen p { font-size:1.5em; color:var(--secondary); }
#final-screen .start-btn { padding:20px 60px; font-size:1.5em; }

@keyframes fadeIn { from {opacity:0; transform:translateY(-20px);} to{opacity:1; transform:translateY(0);} }

@media(max-width:768px){ .webcam-section{flex-direction:column;} canvas{width:100% !important;height:auto !important;} }
</style>
</head>

<body>
<header>Reconhecimento IA ü§ñ</header>

<section class="hero-section" id="inicio">
<div class="hero-text">
  <h2>Sinta o poder da <span>intelig√™ncia artificial</span> üí°</h2>
  <p>Nosso projeto usa a Teachable Machine para reconhecer imagens em tempo real usando sua webcam. Ideal para educa√ß√£o, aprendizado e divers√£o.</p>
  <input type="text" id="username" placeholder="Digite seu nome" />
  <button class="start-btn" id="start-btn" onclick="init()">Come√ßar üöÄ</button>
</div>
<img src="https://cdn.pixabay.com/photo/2023/04/06/15/11/artificial-intelligence-7904390_1280.jpg" alt="Imagem Principal IA" class="hero-main-image" />
</section>

<div id="ranking">
  <h3>Ranking</h3>
  <ol id="ranking-list"></ol>
</div>

<main id="modelo">
<div class="webcam-section">
  <div id="webcam-container"></div>
  <div class="emotion-panel">
    <div id="current-emotion">üòÑ ALEGRIA</div>
    <div id="score-display">Pontua√ß√£o: 0</div>
    <div id="feedback"></div>
  </div>
</div>
<div id="progress-container"><div id="progress-bar"></div></div>
</main>

<div id="final-screen">
  <h2>üéâ UAU! Voc√™ concluiu! üéâ</h2>
  <p id="final-score">Pontua√ß√£o final: 0</p>
  <p id="final-time">Tempo total: 0 segundos</p>
  <div class="image-carousel" id="final-carousel">
    <button class="carousel-btn carousel-prev">&#10094;</button>
    <div class="image-carousel-track" id="final-carousel-track"></div>
    <button class="carousel-btn carousel-next">&#10095;</button>
  </div>
  <button class="start-btn" onclick="location.reload()">Refazer Teste üîÅ</button>
</div>

<audio id="click-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_f95c602d48.mp3?filename=click-124467.mp3" preload="auto"></audio>

<script>
const clickSound = document.getElementById('click-sound');
const startBtn = document.getElementById('start-btn');
const modeloSection = document.getElementById('modelo');
const inicioSection = document.getElementById('inicio');
const currentEmotion = document.getElementById('current-emotion');
const scoreDisplay = document.getElementById('score-display');
const feedback = document.getElementById('feedback');
const webcamContainer = document.getElementById('webcam-container');
const finalScreen = document.getElementById('final-screen');
const finalScore = document.getElementById('final-score');
const finalTime = document.getElementById('final-time');
const progressBar = document.getElementById('progress-bar');
const usernameInput = document.getElementById('username');
const rankingList = document.getElementById('ranking-list');

const finalCarouselTrack = document.getElementById('final-carousel-track');
const carouselPrev = document.querySelector('.carousel-prev');
const carouselNext = document.querySelector('.carousel-next');

let username = '';
const emotionsToTest = ["alegria","tristeza","raiva","nojo","medo"];
const emotionEmojis = { alegria:"üòÑ", tristeza:"üò¢", raiva:"üò°", nojo:"ü§¢", medo:"üò±"};
let currentEmotionIndex = 0, score = 0, startTime;
let capturedImages = [];

async function init(){
  if(!usernameInput.value.trim()){ alert("Digite seu nome para come√ßar!"); return; }
  username = usernameInput.value.trim();
  clickSound.play();
  startBtn.disabled=true; startBtn.innerHTML=`Carregando...`;

  try{
    const URL="https://mellz980.github.io/projetofecart2025/";
    const model=await tmImage.load(URL+"model.json", URL+"metadata.json");
    const webcam=new tmImage.Webcam(560,360,true);
    await webcam.setup(); await webcam.play();

    webcamContainer.innerHTML=""; webcamContainer.appendChild(webcam.canvas);
    inicioSection.style.display="none"; modeloSection.classList.add('active');
    startTime=Date.now();
    currentEmotionIndex=0; score=0; capturedImages=[];
    progressBar.style.width = '0%';

    runEmotionTest(webcam, model);
  }catch(err){
    alert("Erro: "+err.message);
    startBtn.disabled=false; startBtn.innerHTML="Come√ßar üöÄ";
  }
}

async function runEmotionTest(webcam, model){
  if(currentEmotionIndex>=emotionsToTest.length){
    const totalTime=Math.floor((Date.now()-startTime)/1000);
    showFinalScreen(totalTime);
    saveRanking();
    return;
  }

  const expected=emotionsToTest[currentEmotionIndex];
  currentEmotion.textContent = `${emotionEmojis[expected]} ${expected.toUpperCase()}`;
  feedback.textContent="";
  webcamContainer.classList.add('capturing');

  await new Promise(r=>setTimeout(r,1500));
  webcam.update();
  const prediction=await model.predict(webcam.canvas);
  const imageData = webcam.canvas.toDataURL('image/png');
  capturedImages.push({src:imageData, emotion:expected});

  const correct = prediction.some(p=>p.className.toLowerCase()===expected && p.probability>=0.8);

  if(correct){
    feedback.textContent = `‚úÖ Acertou! +200 pontos`;
    feedback.classList.add('correct'); feedback.classList.remove('wrong');
    webcamContainer.classList.add('correct'); webcamContainer.classList.remove('wrong');
    score+=200;
  } else {
    feedback.textContent = `‚ùå Errou!`;
    feedback.classList.add('wrong'); feedback.classList.remove('correct');
    webcamContainer.classList.add('wrong'); webcamContainer.classList.remove('correct');
  }

  scoreDisplay.textContent = "Pontua√ß√£o: "+score;
  progressBar.style.width = `${Math.floor((currentEmotionIndex+1)/emotionsToTest.length*100)}%`;
  webcamContainer.classList.remove('capturing');

  setTimeout(()=>{
    feedback.textContent="";
    webcamContainer.classList.remove('correct','wrong');
    currentEmotionIndex++;
    runEmotionTest(webcam, model);
  },2000);
}

function showFinalScreen(totalTime){
  modeloSection.style.display='none';
  finalScreen.classList.add('active');
  finalScore.textContent="Pontua√ß√£o final: "+score+" pontos";
  finalTime.textContent="Tempo total: "+totalTime+" segundos";

  finalCarouselTrack.innerHTML='';
  capturedImages.forEach((img,i)=>{
    const div = document.createElement('div');
    div.style.textAlign='center';
    const imageEl = document.createElement('img');
    imageEl.src=img.src; imageEl.style.width='220px';
    imageEl.classList.add(i===0?'active':'');
    const label = document.createElement('div'); label.textContent=img.emotion.toUpperCase(); 
    div.appendChild(imageEl); div.appendChild(label);
    finalCarouselTrack.appendChild(div);
  });
}

// Ranking localStorage + remover
function saveRanking(){
  let ranking = JSON.parse(localStorage.getItem('ranking')||'[]');
  ranking.push({name:username, score:score});
  ranking.sort((a,b)=>b.score-a.score);
  localStorage.setItem('ranking', JSON.stringify(ranking.slice(0,5)));
  renderRanking();
}

function renderRanking(){
  let ranking = JSON.parse(localStorage.getItem('ranking')||'[]');
  rankingList.innerHTML='';
  ranking.forEach((item,i)=>{
    const li = document.createElement('li');
    li.textContent=`${i+1}¬∫ - ${item.name}: ${item.score} pts`;
    const removeSpan = document.createElement('span');
    removeSpan.textContent='[remover]';
    removeSpan.onclick = ()=>{
      ranking.splice(i,1);
      localStorage.setItem('ranking', JSON.stringify(ranking));
      renderRanking();
    };
    li.appendChild(removeSpan);
    rankingList.appendChild(li);
  });
}
renderRanking();

// Carrossel final com loop infinito
let idx = 0;
function updateCarousel(n){
  const items = finalCarouselTrack.children;
  if(!items.length) return;
  idx = (n+items.length)%items.length;
  const offset = -idx*230;
  finalCarouselTrack.style.transform = `translateX(${offset}px)`;
  // marcar central
  for(let i=0;i<items.length;i++){
    const img = items[i].querySelector('img');
    img.classList.toggle('active',i===idx);
  }
}
carouselPrev.onclick = ()=>{ updateCarousel(idx-1); clickSound.play(); };
carouselNext.onclick = ()=>{ updateCarousel(idx+1); clickSound.play(); };
setInterval(()=>{ updateCarousel(idx+1); },4000);

</script>
</body>
</html>
